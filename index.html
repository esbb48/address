<!DOCTYPE html>
<html>
  <head>
    <title>Address</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="Content-Style-Type" content="text/css">
    <style type="text/css">
      html, body, #map-canvas {
      height: 90%;
      width: 90%;
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
  </head>
  <body style="margin:0px; padding:0px;">
    <div>
      <textarea cols="80" id="address" rows="6"></textarea>
      <button id="hide">Hide Markers</button>
      <button id="show">Show All Markers</button>
      <button id="delete">Delete Markers</button>
    </div>
    <div id="map-canvas"></div>
  </body>
  <script type="text/javascript">

    var map;
    var markers = [];

    function initialize() {
      var mapOptions = {
        zoom: 8,
        center: new google.maps.LatLng(23.654587852202987, 121.014404296875)
      };

      map = new google.maps.Map(document.getElementById('map-canvas'),
          mapOptions);

      $("#address").on('change',function(){
      var str = $(this).val();
      var TextArr = str.split('\n');
        for (var i = TextArr.length - 1; i >= 0; i--) {
          if(TextArr[i].length>1)
          {
            add = TextArr[i];
            geocoder = new google.maps.Geocoder();
            geocoder.geocode(
             {
              'address':add
             },function (results,status)
             {
               if(status==google.maps.GeocoderStatus.OK)
               {
                  console.log(results[0].geometry.location);
                  LatLng = results[0].geometry.location;
                  map.setCenter(LatLng);  //將地圖中心定位到查詢結果
                  addMarker(LatLng, add);
               }
             }
            );
          }
        };
      });
    }

    function addMarker(location, title) {
      var marker = new google.maps.Marker({
        map: map,
        position: location,
        title: title
      });
      markers.push(marker);
    }

    function setAllMap(map) {
      for (var i = 0; i < markers.length; i++) {
        markers[i].setMap(map);
      }
    }

    $('#delete').on('click',function(){
      $('#hide').click();
      markers = [];
    });
    $('#hide').on('click',function(){
      setAllMap(null);
    });
    $('#show').on('click',function(){
      setAllMap(map);
    });

    google.maps.event.addDomListener(window, 'load', initialize);
  </script>
</html>


